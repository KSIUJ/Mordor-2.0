<!--
    Minimal user interface for tag-based file search
-->

<!DOCTYPE html>
<html style="background-color: rgb(34, 34, 34);">
    <body>
        <form method="get" id="f">
            <input name="q" placeholder="function&&boolean" autocomplete="off">
            <button type="submit">Search</button>
        </form>
        <script>
            // file search on page load
            document.addEventListener('DOMContentLoaded', async () => {
                const params = new URLSearchParams(window.location.search);
                const input = document.querySelector('[name="q"]')
                
                // if URL contains a query searches for matching files
                if(params.get('q')){
                    input.value = params.get('q')
                    const url = new URL('/api/files', location.origin);
                    url.search = params.toString();

                    try{
                        const response = await fetch(url, {method: 'GET'});

                        if(!response.ok){
                            try{
                                const errorData = await response.json();
                                console.error(`Error ${response.status}: ${errorData.detail}`);
                            } catch(error){
                                console.error(`Error ${response.status}: Response is not a valid JSON`);
                            }
                            return
                        }

                        const data = await response.json();
                        // temp display of data in console
                        console.log(data);
                    } catch(error){
                        console.error("Error:", error)
                    }
                }
            })


            // searches matching files by query given in text input field
            document.getElementById('f').addEventListener('submit', async (e)=>{
                e.preventDefault();
                const form = e.target;
                const params = new URLSearchParams(new FormData(form));

                const url = new URL('/api/files', location.origin);
                url.search = params.toString();

                try {
                    const response = await fetch(url, {method: 'GET'});

                    if(!response.ok){
                        try{
                            const errorData = await response.json();
                            console.error(`Error ${response.status}: ${errorData.detail}`);
                        } catch(error){
                            console.error(`Error ${response.status}: Response is not a valid JSON`);
                        }
                        return
                    }

                    const data = await response.json(); 
                    // temp display of data in console
                    console.log(data);
                    window.history.pushState({}, '', `?${params.toString()}`);
                } catch(error){
                    console.error("Error: ", error)
                }

            })
        </script>
    </body>
</html>