<!DOCTYPE html>
<html style="background-color: rgb(34, 34, 34);">
    <body>
        <form method="get" id="f">
            <input name="q" placeholder="calculus&&matrix" autocomplete="off">
            <button type="submit">Search</button>
        </form>
        <script>
            document.addEventListener('DOMContentLoaded', async () => {
                const params = new URLSearchParams(window.location.search);
                const input = document.querySelector('[name="q"]')
                
                if(params.get('q')){
                    input.value = params.get('q')
                    const url = new URL('/api/files', location.origin);
                    url.search = params.toString();

                    try{
                        const response = await fetch(url, {method: 'GET'});

                        if(!response.ok){
                            try{
                                const errorData = await response.json();
                                console.error(`Error ${response.status}: ${errorData.detail}`);
                            } catch(error){
                                console.error(`Error ${response.status}: Response is not a valid JSON`);
                            }
                            return
                        }

                        const data = await response.json();
                        console.log(data);
                    } catch(error){
                        console.error("Error:", error)
                    }
                }
            })


            document.getElementById('f').addEventListener('submit', async (e)=>{
                e.preventDefault();
                const form = e.target;
                const params = new URLSearchParams(new FormData(form));
                if (params.get('q')){
                    const url = new URL('/api/files', location.origin);
                    url.search = params.toString();

                    try {
                        const response = await fetch(url, {method: 'GET'});

                        if(!response.ok){
                            try{
                                const errorData = await response.json();
                                console.error(`Error ${response.status}: ${errorData.detail}`);
                            } catch(error){
                                console.error(`Error ${response.status}: Response is not a valid JSON`);
                            }
                            return
                        }
                        const data = await response.json(); 
                        console.log(data);
                        window.history.pushState({}, '', `?${params.toString()}`);

                    } catch(error){
                        console.error("Error: ", error)
                    }
                }
                else{
                    // to be determined
                }
            })
        </script>
    </body>
</html>